<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Nh·∫∑t Ve Chai - Game Si√™u ƒê·∫πp HTML5</title>
<style>
  body {
    margin: 0;
    padding: 0;
    height: 100vh;
    background: linear-gradient(135deg, #87CEEB 0%, #98D8E8 50%, #E0F7FA 100%);
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .game-container {
    position: relative;
    width: 100%;
    max-width: 500px;
    height: 100%;
    max-height: 850px;
    border: 6px solid #8B4513;
    border-radius: 20px;
    overflow: hidden;
    background: linear-gradient(to bottom, #f8f9fa 0%, #e9ecef 100%);
    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
  }

  #ui {
    position: absolute;
    top: 15px;
    left: 15px;
    right: 15px;
    color: #fff;
    font-weight: bold;
    font-size: 20px;
    text-shadow: 3px 3px 6px rgba(0,0,0,0.7);
    z-index: 10;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  #gameOver {
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, rgba(0,0,0,0.9), rgba(139,69,19,0.8));
    color: #fff;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 20;
    text-align: center;
    padding: 0 20px;
  }

  .hidden { display: none !important; }

  h1 { font-size: 36px; margin: 0 0 20px; text-shadow: 4px 4px 8px rgba(0,0,0,0.8); }

  button {
    padding: 18px 45px;
    font-size: 24px;
    margin-top: 25px;
    border: none;
    border-radius: 15px;
    background: linear-gradient(45deg, #32CD32, #228B22);
    color: white;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 8px 20px rgba(50,205,50,0.4);
  }

  button:hover {
    transform: translateY(-3px) scale(1.05);
    box-shadow: 0 12px 30px rgba(50,205,50,0.6);
  }

  @media (max-width: 520px) {
    #ui { font-size: 18px; flex-direction: column; gap: 5px; }
    h1 { font-size: 28px; }
    button { padding: 16px 35px; font-size: 20px; }
  }
</style>
</head>
<body>

<div class="game-container">
  <div id="ui">
    <div>‚≠ê ƒêI·ªÇM: <span id="score">0</span></div>
    <div>‚è∞ TH·ªúI GIAN: <span id="time">60</span>s</div>
    <div>‚ù§Ô∏è M·∫†NG: <span id="lives">3</span></div>
  </div>

  <canvas id="canvas" width="500" height="800"></canvas>

  <div id="gameOver" class="hidden">
    <h1>üéâ H·∫æT GAME! üéâ</h1>
    <p>ƒêi·ªÉm c·ªßa b·∫°n: <span id="finalScore" style="font-size:28px;color:#FFD700;">0</span></p>
    <p>High Score: <span id="highScore" style="font-size:24px;color:#FFD700;">0</span></p>
    <button id="restart">üö≤ Ch∆°i L·∫°i N√†o! ‚ôªÔ∏è</button>
  </div>
</div>

<script>
// ====================== GAME LOGIC N√ÇNG C·∫§P ======================
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

const scoreEl = document.getElementById('score');
const timeEl  = document.getElementById('time');
const livesEl = document.getElementById('lives');
const gameOverScreen = document.getElementById('gameOver');
const finalScoreEl = document.getElementById('finalScore');
const highScoreEl = document.getElementById('highScore');
const restartBtn = document.getElementById('restart');

let score = 0;
let highScore = localStorage.getItem('veChaiHighScore') || 0;
highScoreEl.textContent = highScore;
let timeLeft = 60;
let lives = 3;
let gameRunning = false;
let lastTime = 0;
let bgOffset = 0; // Background scroll

const player = {
  x: canvas.width/2 - 45,
  y: canvas.height - 140,
  width: 90,
  height: 130,
  speed: 9,
  wheelAngle: 0 // Quay b√°nh xe
};

const items = [];
const particles = []; // Hi·ªáu ·ª©ng h·∫°t

const itemTypes = [
  {name:'üç∂ Chai Nh·ª±a', color:'#00BFFF', points:15, isGood:true, glow:true},
  {name:'ü•§ Lon Bia',    color:'#C0C0C0', points:20, isGood:true, glow:true},
  {name:'üî© S·∫Øt V·ª•n',    color:'#696969', points:18, isGood:true, glow:true},
  {name:'üì¶ Gi·∫•y C≈©',    color:'#D2B48C', points:12, isGood:true, glow:true},
  {name:'üóëÔ∏è R√°c B·∫©n',   color:'#8B0000', points:-25, isGood:false, glow:false}
];

const keys = {};
window.addEventListener('keydown', e=>keys[e.key]=true);
window.addEventListener('keyup', e=>keys[e.key]=false);

// Touch control
let touchX = null;
canvas.addEventListener('touchstart', e=>{e.preventDefault(); touchX = e.touches[0].clientX;});
canvas.addEventListener('touchmove', e=>{e.preventDefault(); touchX = e.touches[0].clientX;});
canvas.addEventListener('touchend', ()=>touchX = null);

function spawnItem() {
  if (!gameRunning) return;
  const type = itemTypes[Math.floor(Math.random()*itemTypes.length)];
  items.push({
    x: Math.random()*(canvas.width-70),
    y: -80,
    width: 65,
    height: 65,
    speed: 2.5 + Math.random()*3,
    rot: 0,
    ...type
  });
}

function spawnParticles(x, y, color, count=15) {
  for(let i=0; i<count; i++) {
    particles.push({
      x, y,
      vx: (Math.random()-0.5)*8,
      vy: (Math.random()-0.5)*8 - 2,
      life: 40,
      color,
      size: Math.random()*4 + 2
    });
  }
}

function drawBackground() {
  // Tr·ªùi gradient
  const skyGrad = ctx.createLinearGradient(0,0,0,canvas.height*0.6);
  skyGrad.addColorStop(0, '#87CEEB');
  skyGrad.addColorStop(1, '#E0F7FA');
  ctx.fillStyle = skyGrad;
  ctx.fillRect(0,0,canvas.width,canvas.height*0.6);

  // M√¢y
  ctx.fillStyle = 'rgba(255,255,255,0.8)';
  ctx.beginPath();
  ctx.arc(100+bgOffset*0.5%canvas.width, 100, 30, 0, Math.PI*2);
  ctx.arc(140+bgOffset*0.5%canvas.width, 90, 40, 0, Math.PI*2);
  ctx.arc(180+bgOffset*0.5%canvas.width, 110, 25, 0, Math.PI*2);
  ctx.fill();

  // ƒê∆∞·ªùng ph·ªë
  const roadGrad = ctx.createLinearGradient(0,canvas.height-200,0,canvas.height);
  roadGrad.addColorStop(0, '#A9A9A9');
  roadGrad.addColorStop(1, '#696969');
  ctx.fillStyle = roadGrad;
  ctx.fillRect(0, canvas.height-200, canvas.width, 200);

  // K·∫ª ƒë∆∞·ªùng tr·∫Øng cu·ªôn
  ctx.strokeStyle = '#FFF';
  ctx.lineWidth = 4;
  for(let i=0; i<canvas.width; i+=100) {
    ctx.beginPath();
    ctx.moveTo(i + (bgOffset%100), canvas.height-100);
    ctx.lineTo(i + 50 + (bgOffset%100), canvas.height-130);
    ctx.stroke();
  }
  bgOffset += 2;
}

function drawPlayer() {
  // Shadow
  ctx.shadowColor = 'rgba(0,0,0,0.3)';
  ctx.shadowBlur = 15;
  ctx.shadowOffsetY = 8;

  // Xe ƒë·∫°p khung
  ctx.fillStyle = '#FFD700';
  ctx.fillRect(player.x+10, player.y+50, player.width-20, 20); // Y√™n xe
  ctx.fillRect(player.x+15, player.y+20, 60, 30); // Khung ch√≠nh

  // B√°nh xe quay
  player.wheelAngle += 0.3;
  ctx.fillStyle = '#333';
  ctx.beginPath();
  ctx.arc(player.x+25, player.y+110, 22, 0, Math.PI*2);
  ctx.fill();
  ctx.lineWidth = 3;
  ctx.strokeStyle = '#111';
  ctx.beginPath();
  ctx.arc(player.x+25, player.y+110, 22, player.wheelAngle, player.wheelAngle + Math.PI*1.8);
  ctx.stroke();

  ctx.beginPath();
  ctx.arc(player.x+player.width-25, player.y+110, 22, 0, Math.PI*2);
  ctx.fill();
  ctx.beginPath();
  ctx.arc(player.x+player.width-25, player.y+110, 22, player.wheelAngle+Math.PI, player.wheelAngle + Math.PI*2.8);
  ctx.stroke();

  // Ng∆∞·ªùi (ƒë·∫ßu, th√¢n, tay)
  ctx.shadowBlur = 0;
  ctx.fillStyle = '#FFDBAC'; // Da
  ctx.beginPath();
  ctx.arc(player.x+player.width/2, player.y+25, 18, 0, Math.PI*2); // ƒê·∫ßu
  ctx.fill();

  ctx.fillStyle = '#FF4500'; // √Åo
  ctx.fillRect(player.x+25, player.y+45, player.width-50, 50);

  ctx.fillStyle = '#8B4513'; // Qu·∫ßn
  ctx.fillRect(player.x+30, player.y+95, player.width-60, 25);

  // N√≥n l√°
  ctx.fillStyle = '#228B22';
  ctx.beginPath();
  ctx.ellipse(player.x+player.width/2, player.y+15, 25, 12, 0, 0, Math.PI*2);
  ctx.fill();

  ctx.shadowColor = 'rgba(0,0,0,0.5)';
  ctx.shadowBlur = 10;
}

function drawItem(item) {
  ctx.save();
  ctx.translate(item.x + item.width/2, item.y + item.height/2);
  ctx.rotate(item.rot);
  item.rot += 0.05;

  // Glow cho good item
  if (item.glow) {
    ctx.shadowColor = item.color;
    ctx.shadowBlur = 20;
  }

  // V·∫Ω item ƒë·∫πp h∆°n
  if (item.name.includes('Chai')) {
    // Chai nh·ª±a
    const grad = ctx.createLinearGradient(0,-25,0,25);
    grad.addColorStop(0, '#00FFFF');
    grad.addColorStop(1, item.color);
    ctx.fillStyle = grad;
    ctx.beginPath();
    ctx.moveTo(0,-25);
    ctx.lineTo(-15,15);
    ctx.lineTo(-10,30);
    ctx.lineTo(10,30);
    ctx.lineTo(15,15);
    ctx.lineTo(0,-25);
    ctx.fill();
  } else if (item.name.includes('Lon')) {
    // Lon
    ctx.fillStyle = item.color;
    ctx.fillRect(-22,-25,44,50);
    ctx.strokeStyle = '#FFF';
    ctx.lineWidth = 2;
    ctx.strokeRect(-22,-25,44,50);
  } else if (item.name.includes('S·∫Øt')) {
    // S·∫Øt v·ª•n
    ctx.fillStyle = item.color;
    ctx.beginPath();
    ctx.moveTo(0, -25);
    ctx.lineTo(-20,10);
    ctx.lineTo(20,5);
    ctx.lineTo(10,25);
    ctx.lineTo(-15,20);
    ctx.closePath();
    ctx.fill();
  } else if (item.name.includes('Gi·∫•y')) {
    // Gi·∫•y h·ªôp
    ctx.fillStyle = item.color;
    ctx.fillRect(-20,-25,40,50);
    ctx.strokeStyle = '#654321';
    ctx.lineWidth = 3;
    ctx.strokeRect(-20,-25,40,50);
  } else {
    // R√°c b·∫©n
    ctx.fillStyle = item.color;
    ctx.beginPath();
    ctx.arc(0,0,25,0,Math.PI*2);
    ctx.fill();
  }

  ctx.restore();
  ctx.shadowBlur = 0;
}

function update(delta) {
  // Player move
  if (keys['ArrowLeft'] || keys['a']) player.x -= player.speed;
  if (keys['ArrowRight'] || keys['d']) player.x += player.speed;
  if (touchX !== null) {
    player.x = touchX - canvas.getBoundingClientRect().left - player.width/2;
  }
  player.x = Math.max(0, Math.min(canvas.width - player.width, player.x));

  // Items
  for(let i=items.length-1; i>=0; i--) {
    const item = items[i];
    item.y += item.speed;

    // Collision
    if (item.y + item.height > player.y &&
        item.y < player.y + player.height &&
        Math.abs(item.x - player.x) < player.width/2 + item.width/2) {
      score += item.points;
      score = Math.max(0, score);
      scoreEl.textContent = score;
      if (score > highScore) {
        highScore = score;
        localStorage.setItem('veChaiHighScore', highScore);
        highScoreEl.textContent = highScore;
      }

      if (item.isGood) {
        spawnParticles(item.x + item.width/2, item.y + item.height/2, item.color);
      } else {
        lives--;
        livesEl.textContent = lives;
        if (lives <= 0) endGame();
      }
      items.splice(i,1);
      continue;
    }

    if (item.y > canvas.height) items.splice(i,1);
  }

  // Particles
  for(let i=particles.length-1; i>=0; i--) {
    const p = particles[i];
    p.x += p.vx;
    p.y += p.vy;
    p.vy += 0.2; // Gravity
    p.life--;
    p.vx *= 0.98;
    if (p.life <= 0) particles.splice(i,1);
  }
}

function render() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawBackground();
  drawPlayer();

  items.forEach(drawItem);
  particles.forEach(p => {
    ctx.save();
    ctx.globalAlpha = p.life / 40;
    ctx.fillStyle = p.color;
    ctx.shadowColor = p.color;
    ctx.shadowBlur = 10;
    ctx.beginPath();
    ctx.arc(p.x, p.y, p.size, 0, Math.PI*2);
    ctx.fill();
    ctx.restore();
  });
}

function gameLoop(timestamp) {
  if (!lastTime) lastTime = timestamp;
  const delta = Math.min((timestamp - lastTime)/16, 2); // 60fps cap
  lastTime = timestamp;

  if (gameRunning) {
    update(delta);
    render();
    requestAnimationFrame(gameLoop);
  }
}

function startGame() {
  score = 0;
  timeLeft = 60;
  lives = 3;
  items.length = 0;
  particles.length = 0;
  scoreEl.textContent = score;
  timeEl.textContent = timeLeft;
  livesEl.textContent = lives;
  gameOverScreen.classList.add('hidden');
  gameRunning = true;
  lastTime = 0;
  bgOffset = 0;

  requestAnimationFrame(gameLoop);

  const timer = setInterval(() => {
    if (!gameRunning) { clearInterval(timer); return; }
    timeLeft--;
    timeEl.textContent = timeLeft;
    if (timeLeft <= 0) { clearInterval(timer); endGame(); }
  }, 1000);

  setInterval(spawnItem, 1000); // Nhanh h∆°n t√≠
}

function endGame() {
  gameRunning = false;
  finalScoreEl.textContent = score;
  highScoreEl.textContent = highScore;
  gameOverScreen.classList.remove('hidden');
}

restartBtn.onclick = startGame;
startGame();
</script>
</body>
</html>
