<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flappy Bird Vi·ªát - C·ªë L√™n! (C√≥ √Çm Thanh)</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(to bottom, skyblue, lightblue);
            font-family: Arial, sans-serif;
        }
        canvas {
            border: 2px solid #333;
            background: linear-gradient(to bottom, #87CEEB, #98D8E9);
            box-shadow: 0 0 20px rgba(0,0,0,0.3);
            max-width: 100%;
            max-height: 100vh;
        }
        .instructions {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            font-size: 14px;
            text-shadow: 1px 1px 2px black;
        }
        .sound-info {
            position: absolute;
            bottom: 10px;
            left: 10px;
            color: white;
            font-size: 12px;
            text-shadow: 1px 1px 2px black;
            background: rgba(0,0,0,0.5);
            padding: 5px 10px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="instructions">
        Nh·∫•n <strong>SPACE</strong> ho·∫∑c <strong>CLICK/TOUCH</strong> ƒë·ªÉ nh·∫£y!<br>
        ƒêi·ªÉm cao: <span id="highScore">0</span>
    </div>
    <div class="sound-info">
        üîä "C·ªë l√™n c·ªë l√™n, s·∫Øp t·ªõi r·ªìi s·∫Øp t·ªõi r·ªìi!"<br>
        Ph√°t t·ª± ƒë·ªông m·ªói <strong>10 gi√¢y</strong> m·ªôt l·∫ßn! üé§
    </div>
    <canvas id="canvas" width="400" height="600"></canvas>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const WIDTH = canvas.width;
        const HEIGHT = canvas.height;

        // Tr·∫°ng th√°i game
        let bird = { x: 80, y: HEIGHT / 2, vy: 0, radius: 18 };
        let gravity = 0.4;
        let jumpForce = -9;
        let pipes = [];
        let score = 0;
        let highScore = localStorage.getItem('flappyHighScore') || 0;
        let gameOver = false;
        let frame = 0;
        let lastSpeechTime = 0;
        const SPEECH_INTERVAL = 10000; // 10 gi√¢y (ms)
        const PIPE_WIDTH = 60;
        const PIPE_GAP = 220;
        const PIPE_SPEED = 2.5;
        const PIPE_INTERVAL = 110;

        // C·∫≠p nh·∫≠t high score
        document.getElementById('highScore').textContent = highScore;

        // Speech Synthesis
        let utterance;
        function initSpeech() {
            utterance = new SpeechSynthesisUtterance('C·ªë l√™n c·ªë l√™n, s·∫Øp t·ªõi r·ªìi s·∫Øp t·ªõi r·ªìi!');
            utterance.lang = 'vi-VN';
            utterance.rate = 1.6;  // Nhanh ƒë·ªÉ fit game
            utterance.pitch = 1.3; // Vui v·∫ª
            utterance.volume = 0.9;
        }
        function speak() {
            if (window.speechSynthesis) {
                window.speechSynthesis.cancel(); // D·ª´ng queue c≈©
                window.speechSynthesis.speak(utterance);
            }
        }

        // Kh·ªüi t·∫°o speech
        initSpeech();

        // Reset game
        function reset() {
            bird.y = HEIGHT / 2;
            bird.vy = 0;
            pipes = [];
            score = 0;
            gameOver = false;
            frame = 0;
            lastSpeechTime = 0;
            window.speechSynthesis.cancel(); // D·ª´ng √¢m thanh khi reset
            speak(); // Ph√°t ngay khi b·∫Øt ƒë·∫ßu game m·ªõi
        }

        // V·∫Ω ·ªëng (gi·ªØ nguy√™n)
        function drawPipe(pipe) {
            const capHeight = 35;
            const capOverhang = 15;

            ctx.fillStyle = '#4A7C2A';
            ctx.strokeStyle = '#3A5C1A';
            ctx.lineWidth = 3;

            // ·ªêng tr√™n
            ctx.fillRect(pipe.x, 0, PIPE_WIDTH, pipe.top);
            ctx.strokeRect(pipe.x, 0, PIPE_WIDTH, pipe.top);
            // N·∫Øp tr√™n
            ctx.fillRect(pipe.x - capOverhang, pipe.top - capHeight, PIPE_WIDTH + 2 * capOverhang, capHeight);
            ctx.strokeRect(pipe.x - capOverhang, pipe.top - capHeight, PIPE_WIDTH + 2 * capOverhang, capHeight);

            // ·ªêng d∆∞·ªõi
            const lowerY = pipe.top + PIPE_GAP;
            ctx.fillRect(pipe.x, lowerY, PIPE_WIDTH, HEIGHT - 80 - lowerY);
            ctx.strokeRect(pipe.x, lowerY, PIPE_WIDTH, HEIGHT - 80 - lowerY);
            // N·∫Øp d∆∞·ªõi
            ctx.fillRect(pipe.x - capOverhang, lowerY, PIPE_WIDTH + 2 * capOverhang, capHeight);
            ctx.strokeRect(pipe.x - capOverhang, lowerY, PIPE_WIDTH + 2 * capOverhang, capHeight);
        }

        // V·∫Ω chim (gi·ªØ nguy√™n)
        function drawBird() {
            ctx.save();
            ctx.translate(bird.x, bird.y);
            const rotation = Math.min(Math.max(bird.vy * 0.08, -0.3), 0.8);
            ctx.rotate(rotation);

            // Th√¢n chim
            const gradient = ctx.createRadialGradient(0, 0, 0, 0, 0, bird.radius);
            gradient.addColorStop(0, '#FFD700');
            gradient.addColorStop(1, '#FFA500');
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.arc(0, 0, bird.radius, 0, Math.PI * 2);
            ctx.fill();
            ctx.strokeStyle = '#FF8C00';
            ctx.lineWidth = 2;
            ctx.stroke();

            // M·∫Øt
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.arc(12, -6, 9, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = 'black';
            ctx.beginPath();
            ctx.arc(15, -6, 5, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.arc(17, -8, 2, 0, Math.PI * 2);
            ctx.fill();

            // M·ªè
            ctx.fillStyle = '#FF4500';
            ctx.beginPath();
            ctx.moveTo(bird.radius, -2);
            ctx.lineTo(bird.radius + 18, -2);
            ctx.lineTo(bird.radius + 22, 0);
            ctx.lineTo(bird.radius + 18, 4);
            ctx.lineTo(bird.radius, 2);
            ctx.fill();

            // C√°nh
            ctx.fillStyle = 'rgba(255, 215, 0, 0.6)';
            ctx.beginPath();
            ctx.ellipse(-5, 5, 12, 8, 0.3, 0, Math.PI * 2);
            ctx.fill();

            ctx.restore();
        }

        // V·∫Ω bong b√≥ng tho·∫°i (th√™m hi·ªáu ·ª©ng khi ƒëang n√≥i)
        function drawSpeechBubble() {
            const bubbleX = bird.x - 60;
            const bubbleY = bird.y - 100;
            const bubbleWidth = 220;
            const bubbleHeight = 70;

            // Ki·ªÉm tra ƒëang n√≥i kh√¥ng (hi·ªáu ·ª©ng rung m·∫°nh h∆°n)
            const isSpeaking = window.speechSynthesis.speaking;

            // Bong b√≥ng
            ctx.fillStyle = isSpeaking ? '#FFF8DC' : 'white'; // V√†ng nh·∫°t khi n√≥i
            ctx.strokeStyle = isSpeaking ? '#FFD700' : 'black';
            ctx.lineWidth = isSpeaking ? 4 : 3;
            ctx.lineJoin = 'round';
            ctx.beginPath();
            ctx.roundRect(bubbleX, bubbleY, bubbleWidth, bubbleHeight, 15);
            ctx.fill();
            ctx.stroke();

            // ƒêu√¥i bong b√≥ng
            ctx.beginPath();
            ctx.moveTo(bubbleX + 90, bubbleY + bubbleHeight);
            ctx.lineTo(bubbleX + 110, bubbleY + bubbleHeight + 20);
            ctx.lineTo(bubbleX + 130, bubbleY + bubbleHeight);
            ctx.fill();
            ctx.stroke();

            // Text v·ªõi rung khi n√≥i
            ctx.fillStyle = '#333';
            ctx.font = 'bold 16px Arial, sans-serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            const shake = isSpeaking ? Math.sin(frame * 0.3) * 3 : Math.sin(frame * 0.5) * 2;
            ctx.fillText('C·ªë l√™n c·ªë l√™n,', bubbleX + bubbleWidth / 2 + shake, bubbleY + 25);
            ctx.fillText('s·∫Øp t·ªõi r·ªìi s·∫Øp t·ªõi r·ªìi!', bubbleX + bubbleWidth / 2 + shake, bubbleY + 50);

            // Hi·ªáu ·ª©ng glow khi n√≥i
            if (isSpeaking) {
                ctx.shadowColor = 'gold';
                ctx.shadowBlur = 15;
                ctx.fillText('C·ªë l√™n c·ªë l√™n,', bubbleX + bubbleWidth / 2 + shake, bubbleY + 25);
                ctx.fillText('s·∫Øp t·ªõi r·ªìi s·∫Øp t·ªõi r·ªìi!', bubbleX + bubbleWidth / 2 + shake, bubbleY + 50);
                ctx.shadowBlur = 0;
            }
        }

        // V·∫Ω n·ªÅn (gi·ªØ nguy√™n)
        function drawBackground() {
            const skyGrad = ctx.createLinearGradient(0, 0, 0, HEIGHT);
            skyGrad.addColorStop(0, '#87CEEB');
            skyGrad.addColorStop(0.5, '#B0E0E6');
            skyGrad.addColorStop(1, '#E0F6FF');
            ctx.fillStyle = skyGrad;
            ctx.fillRect(0, 0, WIDTH, HEIGHT);

            ctx.fillStyle = 'rgba(255, 255, 0, 0.8)';
            ctx.strokeStyle = 'rgba(255, 200, 0, 0.8)';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.arc(340, 70, 35, 0, Math.PI * 2);
            ctx.fill();
            ctx.stroke();

            const groundGrad = ctx.createLinearGradient(0, HEIGHT - 80, 0, HEIGHT);
            groundGrad.addColorStop(0, '#90EE90');
            groundGrad.addColorStop(1, '#228B22');
            ctx.fillStyle = groundGrad;
            ctx.fillRect(0, HEIGHT - 80, WIDTH, 80);

            ctx.fillStyle = '#32CD32';
            for (let i = 0; i < WIDTH; i += 15) {
                ctx.beginPath();
                ctx.moveTo(i, HEIGHT - 80);
                ctx.lineTo(i + 7 + Math.sin(frame * 0.1 + i * 0.01) * 2, HEIGHT - 100);
                ctx.lineTo(i + 14, HEIGHT - 80);
                ctx.fill();
            }
        }

        // V·∫Ω UI (gi·ªØ nguy√™n)
        function drawUI() {
            ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
            ctx.strokeStyle = 'black';
            ctx.lineWidth = 2;
            ctx.font = 'bold 48px Arial, sans-serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            const scoreText = score.toString();
            const scoreW = ctx.measureText(scoreText).width;
            ctx.beginPath();
            ctx.roundRect(WIDTH / 2 - scoreW / 2 - 10, 40, scoreW + 20, 70, 15);
            ctx.fill();
            ctx.stroke();
            ctx.fillStyle = '#FFD700';
            ctx.font = 'bold 52px Arial, sans-serif';
            ctx.fillText(scoreText, WIDTH / 2, 75);

            if (gameOver) {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                ctx.fillRect(0, 0, WIDTH, HEIGHT);

                ctx.fillStyle = 'white';
                ctx.strokeStyle = 'gold';
                ctx.lineWidth = 4;
                ctx.font = 'bold 40px Arial, sans-serif';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                const gameOverW = ctx.measureText('GAME OVER').width;
                ctx.beginPath();
                ctx.roundRect(WIDTH / 2 - gameOverW / 2 - 15, HEIGHT / 2 - 100, gameOverW + 30, 60, 15);
                ctx.fill();
                ctx.stroke();
                ctx.fillStyle = '#FF4500';
                ctx.font = 'bold 44px Arial, sans-serif';
                ctx.fillText('GAME OVER', WIDTH / 2, HEIGHT / 2 - 70);

                ctx.fillStyle = 'white';
                ctx.font = 'bold 28px Arial, sans-serif';
                const restartW = ctx.measureText('SPACE ƒë·ªÉ ch∆°i l·∫°i!').width;
                ctx.beginPath();
                ctx.roundRect(WIDTH / 2 - restartW / 2 - 10, HEIGHT / 2 + 20, restartW + 20, 50, 12);
                ctx.fill();
                ctx.stroke();
                ctx.fillStyle = '#32CD32';
                ctx.font = 'bold 26px Arial, sans-serif';
                ctx.fillText('SPACE ƒë·ªÉ ch∆°i l·∫°i!', WIDTH / 2, HEIGHT / 2 + 45);

                if (score > highScore) {
                    highScore = score;
                    localStorage.setItem('flappyHighScore', highScore);
                    document.getElementById('highScore').textContent = highScore;
                }
            }
        }

        // C·∫≠p nh·∫≠t logic (th√™m speech timer)
        function update() {
            if (gameOver) return;

            frame++;

            // Ph√°t √¢m thanh m·ªói 10s
            const now = performance.now();
            if (now - lastSpeechTime > SPEECH_INTERVAL) {
                speak();
                lastSpeechTime = now;
            }

            // V·∫≠t l√Ω chim
            bird.vy += gravity;
            bird.y += bird.vy;

            if (bird.y + bird.radius > HEIGHT - 80 || bird.y - bird.radius < 0) {
                gameOver = true;
            }

            if (frame % PIPE_INTERVAL === 0) {
                const topHeight = 100 + Math.random() * (HEIGHT - 350 - PIPE_GAP);
                pipes.push({ x: WIDTH, top: topHeight, passed: false });
            }

            for (let i = pipes.length - 1; i >= 0; i--) {
                const pipe = pipes[i];
                pipe.x -= PIPE_SPEED;

                if (pipe.x + PIPE_WIDTH < 0) {
                    pipes.splice(i, 1);
                    continue;
                }

                if (bird.x + bird.radius > pipe.x && bird.x - bird.radius < pipe.x + PIPE_WIDTH) {
                    if (bird.y - bird.radius < pipe.top || bird.y + bird.radius > pipe.top + PIPE_GAP) {
                        gameOver = true;
                    }
                }

                if (!pipe.passed && pipe.x + PIPE_WIDTH < bird.x) {
                    pipe.passed = true;
                    score++;
                }
            }
        }

        // V·∫Ω to√†n b·ªô
        function draw() {
            drawBackground();
            pipes.forEach(drawPipe);
            drawBird();
            drawSpeechBubble();
            drawUI();
        }

        // Game loop
        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        // ƒêi·ªÅu khi·ªÉn
        function jump() {
            if (gameOver) {
                reset();
            } else {
                bird.vy = jumpForce;
                // Ph√°t th√™m khi nh·∫£y ƒë·ªÉ kh√≠ch l·ªá (t√πy ch·ªçn, kh√¥ng l·∫∑p)
                if (Math.random() < 0.3) speak(); // 30% c∆° h·ªôi
            }
        }

        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                e.preventDefault();
                jump();
            }
        });

        canvas.addEventListener('click', jump);
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            jump();
        });

        // T·ª± ƒë·ªông b·∫Øt ƒë·∫ßu v√† ph√°t speech ƒë·∫ßu ti√™n
        window.speechSynthesis.cancel(); // Clear n·∫øu c√≥
        speak(); // Test speech ngay khi load

        gameLoop();
    </script>
</body>
</html>
